var data = { 
  AZ : {
    Budget : {
      Schools : 4000,
      Defense : 5000
    },
  },
  AL : {
    Budget : {
      Schools : 10,
      Defense : 50
    }
  }
};

var schema = { 
  name : "State",
  type : "object",

  properties : {
    name : "Category",
    type : "object",

    properties : {
      name : "Value",
      type : "number"
    }
  }
};


function flatten(json, schema){
    var nj = {},
        walk = function(j, schema){
            var jp;
            for(var prop in j){
                jp = j[prop];
                key = "";
                console.log(schema)
                for(var t in schema) {
                  key = t;
                  break;
                }
                if(jp.toString() === "[object Object]"){
                    walk(jp, schema.properties);
                    nj[schema.name] = prop;
                    // console.log(schema);
                }else{
                    nj[prop] = jp;
                }
            }
        };
    walk(json, schema);
    return nj;
}

flatten(data, schema);